# 操作系统课设 🖥️

可能是西电最有用的课设之一了
做这个的过程中还是学到了不少东西了
不过代码已经丢失了，只能从超星上抢救下来一个实验报告（
由于时间过去有点久了，我的记忆也有点模糊，下面每道题的描述是从超星上扒下来的，不过补充说明不一定准确，说不定就是记错了

## 📋 实验内容

### 实验一：Shell脚本生成实验

这个实验要求编写一个生成器脚本，该脚本能够生成另一个功能性脚本。生成的脚本需要满足以下要求：

- 接收两个参数：
  - 参数1：要读写的文件路径
  - 参数2：标志位，用于标识是读操作还是写操作
- 功能：对参数1指定的文件进行读写操作
- 写入内容："自己学号的后3位 MYFILE"
- 要求自动执行生成的脚本（执行写入功能）
- 使用strace命令观察脚本执行过程，分析系统调用情况

这个实验不难，稍微学一下就能写，即使不会写也能 push ai 写（不是

### 实验二：Semaphore使用实验

这个实验要求使用信号量(semaphore)来实现进程间同步，具体要求：

- 创建2个进程（注意：非线程）
- 这两个进程需要写同一个文件
- 要求互斥写入，即只有一个进程写完后，才能让另一个进程写
- 进程1写入内容："自己学号的后3位PROC1 MYFILE1"
- 进程2写入内容："自己学号的后3位PROC2 MYFILE2"
- 将使用semaphore的实现替换成使用strict alternation算法的忙等待互斥锁

这个真得学一下了，可以看看配套课程录播，不过也很容易实现

### 实验三：Runqueue长度观测实验

这个实验要求使用eBPF进行系统观测，具体要求：

- 基于给定的eBPF编程框架（`桌面/develop/src/01-sched-lab/ebpf/rqlen.bt`）
- 填写相关代码，使得该eBPF程序能够观察信创操作系统中CFS调度队列上runqueue的长度
- 基于给定的eBPF编程框架（`桌面/develop/src/01-sched-lab/ebpf/switchcnt.bt`）
- 填写相关代码，使得该eBPF程序能够观察信创操作系统中指定进程被调度的次数

这个实验通过eBPF技术让我们能够深入观察操作系统内核的调度行为，无需修改内核代码就能获取关键信息。eBPF作为现代Linux系统性能分析和监控的重要工具，这个实验很有实际意义。

这个还是很有意思的，代码实际上很短，但是由于 ebpf 相关资料有点少，所以我当时还是花了不少时间

具体来说就是 ebpf 具有各种探针
你需要选择合适的探针在合适的函数入口/出口处触发
当时找到的学 ebpf 的博客等似乎没存收藏夹，找不到了

### 实验四：RR调度算法定制实验（知识点1.11节）

这个实验要求修改内核中的RR（轮转）调度算法，具体要求：

- 利用给定的RR调度程序（`桌面/develop/src/01-sched-lab/kernel/patch.c`）
- 填写相关代码，对信创操作系统中的RR调度算法进行定制
- 特殊需求：修改RR调度的进程插入逻辑，使其保持固定顺序
  - 若进程当前执行顺序是【1】【2】【3】
  - 当第四个进程转为运行态后，必须维持这个顺序，即变为【1】【2】【3】【4】
  - 不能按照原始RR将新进程插入队列尾部
  - 例如：若当前队列是【2】【3】【1】，进程【4】必须插在【3】之后，形成【2】【3】【4】【1】

这道题我实际上没有完成，我改的有bug，直接导致编译内核并安装后开不了机
但是因为当时笔记本的弱鸡性能，编译一次需要很长时间，验证成本很高，所以就懒得修bug了

### 实验五：添加系统调用实验（知识点1.5节）

这个实验要求向内核添加一个新的系统调用，具体要求：

- 系统调用接受两个参数：
  - 参数1：以整型数表示的自己学号的后3位
  - 参数2：flag，取值为0或1
    - 若为0，系统调用返回参数1的个位
    - 若为1，系统调用返回参数1的十位
- 还需加入内核互斥锁，使得两个进程在调用该系统调用时能互斥访问

应该先做实验 7 再做这道题比较好，实验 7 给了非常详细的资料，告诉你先在哪+代码，再在哪写代码，做完实验 7 后就可以照猫画虎很容易地解决这道题，不算困难

### 实验六：进程地址空间布局实验（知识点1.9和1.10节）

这个实验要求使用eBPF技术观察进程的地址空间布局，具体要求：

- 基于给定的eBPF编程框架（`桌面/develop/src/02-mem-lab/ebpf/mm.bt`）
- 填写相关代码，使该eBPF程序能够观察信创操作系统中指定进程的：
  - 代码段（text）的起始和结束位置
  - 数据段（data）的起始和结束位置
  - 栈（stack）的起始位置

### 实验七：进程页表修改实验（知识点1.10节）

这个实验要求实现一个系统调用，允许一个进程窥探另一个进程的页面内容，具体要求：

- 基于给定的系统调用框架（`桌面/develop/src/02-mem-lab/kernel/patch.c`）
- 填写相关代码，完成peep_page系统调用
- 编写两个进程a和b，使得b进程能够窥探a进程中的一个页面信息
- 需理解提供的测试程序，并运行测试程序验证peep_page系统调用的正确性